---
// Visitor Counter Component
---

<div class="fixed bottom-6 right-6 z-40 group">
  <div class="bg-white dark:bg-dark-secondary px-6 py-4 rounded-xl shadow-2xl border-2 border-primary/20 backdrop-blur-sm transition-all duration-300 hover:scale-105 hover:shadow-primary/30">
    <div class="flex items-center gap-3">
      <div class="text-primary">
        <i class="fas fa-eye text-2xl"></i>
      </div>
      <div>
        <p class="text-xs text-gray-500 dark:text-gray-400 font-medium">Visitas totales</p>
        <p id="visitor-count" class="text-2xl font-bold text-primary font-display">0</p>
      </div>
    </div>
    
    <!-- Decorative glow -->
    <div class="absolute -inset-1 bg-gradient-to-r from-primary to-primary-dark rounded-xl opacity-0 group-hover:opacity-20 blur transition-opacity duration-300 -z-10"></div>
  </div>
</div>

<script>
  // Visitor counter with localStorage
  function updateVisitorCount() {
    const COUNTER_KEY = 'devhub_visitor_count';
    const VISITOR_KEY = 'devhub_has_visited';
    
    // Check if user has visited before in this session
    const hasVisited = sessionStorage.getItem(VISITOR_KEY);
    
    // Get current count
    let count = parseInt(localStorage.getItem(COUNTER_KEY) || '0', 10);
    
    // Increment if new visitor in this session
    if (!hasVisited) {
      count += 1;
      localStorage.setItem(COUNTER_KEY, count.toString());
      sessionStorage.setItem(VISITOR_KEY, 'true');
    }
    
    // Display count with animation
    const counterElement = document.getElementById('visitor-count');
    if (counterElement) {
      animateCounter(counterElement, count);
    }
  }
  
  // Animate counter numbers
  function animateCounter(element: HTMLElement, target: number) {
    let current = 0;
    const increment = Math.ceil(target / 20);
    const duration = 1500;
    const stepTime = duration / (target / increment);
    
    const timer = setInterval(() => {
      current += increment;
      if (current >= target) {
        current = target;
        clearInterval(timer);
      }
      element.textContent = current.toLocaleString();
    }, stepTime);
  }
  
  // Initialize on page load
  updateVisitorCount();
  
  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', updateVisitorCount);
</script>

<style>
  /* Smooth animations */
  #visitor-count {
    transition: transform 0.3s ease;
  }
  
  .group:hover #visitor-count {
    transform: scale(1.1);
  }
</style>